/*
 * ============================================================
 *  ANALIZADOR LEXICO - DOCUMENTACION COMPLETA
 *  Lenguaje: PseudoCodigo Espanol v1.0
 * ============================================================
 *  Compilar:  g++ -std=c++17 -o analizador_lexico analizador_lexico.cpp
 *  Ejecutar:  analizador_lexico.exe
 */

#include <iostream>
#include <iomanip>
#include <string>
#include <vector>
#ifdef _WIN32
  #include <windows.h>
#endif
using namespace std;

// Colores ANSI
#define RESET   "\033[0m"
#define BOLD    "\033[1m"
#define CYAN    "\033[1;36m"
#define YELLOW  "\033[1;33m"
#define GREEN   "\033[1;32m"
#define BLUE    "\033[1;34m"
#define MAGENTA "\033[1;35m"
#define RED     "\033[1;31m"
#define WHITE   "\033[1;37m"
#define GRAY    "\033[0;37m"

void limpiarPantalla(){
#ifdef _WIN32
    system("cls");
#else
    system("clear");
#endif
}

void pausar(){
    cout << "\n" << GRAY << "  Presiona ENTER para continuar..." << RESET;
    cin.ignore(); cin.get();
}

void sep(int n=60){
    cout << CYAN;
    for(int i=0;i<n;i++) cout << '=';
    cout << RESET << "\n";
}
void sepD(int n=60){
    cout << GRAY;
    for(int i=0;i<n;i++) cout << '-';
    cout << RESET << "\n";
}
void titulo(const string& t){
    sep();
    int p=(60-(int)t.size())/2;
    cout << CYAN << BOLD;
    for(int i=0;i<p;i++) cout << " ";
    cout << t << RESET << "\n";
    sep();
}

// ============================================================
void mostrarPalabrasReservadas(){
    titulo("PALABRAS RESERVADAS DEL LENGUAJE");
    struct PR{ string p,s; };
    vector<PR> v={
        {"programa",  "Define el cuerpo del programa principal"},
        {"inicio",    "Marca el inicio de un bloque de codigo"},
        {"fin",       "Marca el final de un bloque de codigo"},
        {"var",       "Declaracion de variables"},
        {"const",     "Declaracion de constantes"},
        {"si",        "Estructura condicional (if)"},
        {"entonces",  "Parte then del condicional"},
        {"sino",      "Parte else del condicional"},
        {"mientras",  "Ciclo while"},
        {"hacer",     "Palabra auxiliar para ciclos"},
        {"contar",    "Ciclo for"},
        {"desde",     "Inicio del rango en for"},
        {"hasta",     "Fin del rango en for"},
        {"entero",    "Tipo de dato entero"},
        {"real",      "Tipo de dato real/decimal"},
        {"cadena",    "Tipo de dato string"},
        {"booleano",  "Tipo de dato boolean"},
        {"verdadero", "Valor booleano true"},
        {"falso",     "Valor booleano false"},
        {"leer",      "Funcion para leer entrada del teclado"},
        {"escribir",  "Funcion para imprimir en pantalla"},
        {"limpiar",   "Funcion para limpiar la pantalla"},
    };
    cout << "\n" << GREEN << BOLD << "  " << left << setw(14) << "Palabra"
         << "  Significado\n" << RESET;
    sepD();
    for(auto& x:v)
        cout << "  " << YELLOW << BOLD << left << setw(14) << x.p
             << RESET << "  " << x.s << "\n";
    sepD();
    cout << "\n  Total: " << GREEN << v.size() << RESET << " palabras reservadas\n";
}

void mostrarSimbolos(){
    titulo("SIMBOLOS ESPECIALES");
    struct S{ string s,m; };
    vector<S> v={
        {"+",  "Operador de suma"},
        {"-",  "Operador de resta"},
        {"*",  "Operador de multiplicacion"},
        {"/",  "Operador de division"},
        {"=",  "Operador de asignacion"},
        {">",  "Mayor que"},
        {"<",  "Menor que"},
        {">=", "Mayor o igual que"},
        {"<=", "Menor o igual que"},
        {"==", "Igualdad (comparacion)"},
        {"!=", "Desigualdad"},
        {"()", "Parentesis para agrupacion"},
        {";",  "Separador de sentencias"},
        {":",  "Declaracion de tipo"},
        {",",  "Separador de elementos"},
        {"\"", "Delimitador de cadenas"},
    };
    cout << "\n" << MAGENTA << BOLD << "  " << left << setw(10) << "Simbolo"
         << "  Significado\n" << RESET;
    sepD();
    for(auto& x:v)
        cout << "  " << CYAN << BOLD << left << setw(10) << x.s
             << RESET << "  " << x.m << "\n";
}

void mostrarIdentificadores(){
    titulo("ESPECIFICACION LEXICA: IDENTIFICADORES");
    cout << YELLOW << BOLD << "\n  Mini-Especificacion:\n" << RESET;
    cout << "  Nombres para variables y constantes.\n";
    cout << "  Empiezan con letra, seguida de letras, digitos o '_'.\n";
    cout << YELLOW << BOLD << "\n  Reglas Lexicas:\n" << RESET;
    cout << "  " << GREEN  << "[OK]" << RESET << " Debe comenzar con letra (a-z, A-Z)\n";
    cout << "  " << GREEN  << "[OK]" << RESET << " Puede contener letras, digitos y guion bajo\n";
    cout << "  " << RED    << "[NO]" << RESET << " No puede ser una palabra reservada\n";
    cout << "  " << GREEN  << "[OK]" << RESET << " Sensible a mayusculas y minusculas\n";
    cout << YELLOW << BOLD << "\n  Alfabeto:\n" << RESET;
    cout << "  Sigma = { a-z, A-Z, 0-9, _ }\n";
    cout << YELLOW << BOLD << "\n  Expresion Regular:\n" << RESET;
    cout << "  " << MAGENTA << "ID = [a-zA-Z][a-zA-Z0-9_]*\n" << RESET;
    cout << YELLOW << BOLD << "\n  Automata Finito Determinista (AFD):\n" << RESET;
    cout << "  Estado inicial: q0   Estados finales: { q1 }\n\n";
    cout << CYAN;
    cout << "       [a-zA-Z]              [a-zA-Z0-9_]\n";
    cout << "  q0 ----------> q1(final) <-----------+\n";
    cout << "                      |                |\n";
    cout << "                      +----------------+\n";
    cout << RESET;
    cout << YELLOW << BOLD << "\n  Transiciones:\n" << RESET;
    cout << "  q0 --[a-zA-Z]------> q1\n";
    cout << "  q1 --[a-zA-Z0-9_]--> q1\n";
    cout << YELLOW << BOLD << "\n  Ejemplos validos:   " << RESET
         << GREEN << "contador, valor_total, X, resultado123\n" << RESET;
    cout << "  " << YELLOW << BOLD << "Ejemplos invalidos: " << RESET
         << RED << "123inicio, _variable, si (reservada)\n" << RESET;
}

void mostrarCadenas(){
    titulo("ESPECIFICACION LEXICA: CADENAS");
    cout << YELLOW << BOLD << "\n  Mini-Especificacion:\n" << RESET;
    cout << "  Secuencias de caracteres entre comillas dobles.\n";
    cout << YELLOW << BOLD << "\n  Reglas Lexicas:\n" << RESET;
    cout << "  " << GREEN << "[OK]" << RESET << " Comienzan y terminan con comillas dobles\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Pueden contener letras, digitos, espacios\n";
    cout << "  " << RED   << "[NO]" << RESET << " No pueden contener saltos de linea\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Las comillas internas deben escaparse\n";
    cout << YELLOW << BOLD << "\n  Expresion Regular:\n" << RESET;
    cout << "  " << MAGENTA << "CADENA = \"[^\"\\n]*\"\n" << RESET;
    cout << YELLOW << BOLD << "\n  Automata Finito Determinista (AFD):\n" << RESET;
    cout << "  Estado inicial: q0   Estados finales: { q2 }\n\n";
    cout << CYAN;
    cout << "       [\"]        [^\"]         [\"]\n";
    cout << "  q0 ------> q1 ---------> q1 ------> q2(final)\n";
    cout << "                 ^_________|\n";
    cout << RESET;
    cout << YELLOW << BOLD << "\n  Transiciones:\n" << RESET;
    cout << "  q0 --[\"]-->  q1\n";
    cout << "  q1 --[^\"]-->  q1\n";
    cout << "  q1 --[\"]-->  q2\n";
    cout << YELLOW << BOLD << "\n  Ejemplos validos:   " << RESET
         << GREEN << "\"Hola mundo\", \"123\", \"Valor: 45.7\"\n" << RESET;
    cout << "  " << YELLOW << BOLD << "Ejemplos invalidos: " << RESET
         << RED << "'texto', \"sin cerrar\n" << RESET;
}

void mostrarNumeros(){
    titulo("ESPECIFICACION LEXICA: NUMEROS ENTEROS");
    cout << YELLOW << BOLD << "\n  Reglas Lexicas:\n" << RESET;
    cout << "  " << GREEN << "[OK]" << RESET << " Secuencia de uno o mas digitos\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Pueden comenzar con signo opcional (+ o -)\n";
    cout << "  " << RED   << "[NO]" << RESET << " No contienen punto decimal\n";
    cout << "  " << RED   << "[NO]" << RESET << " No se permiten ceros iniciales (excepto 0)\n";
    cout << YELLOW << BOLD << "\n  Expresion Regular:\n" << RESET;
    cout << "  " << MAGENTA << "ENTERO = [+-]?[0-9]+\n" << RESET;
    cout << "  " << MAGENTA << "ENTERO (sin ceros iniciales) = [+-]?(0|[1-9][0-9]*)\n" << RESET;
    cout << YELLOW << BOLD << "\n  AFD - Estado inicial: q0   Estados finales: { q2 }\n\n" << RESET;
    cout << CYAN;
    cout << "       [+-]       [0-9]         [0-9]\n";
    cout << "  q0 ------> q1 -------> q2 <---------+\n";
    cout << "   |                     |             |\n";
    cout << "   +----[0-9]----------->+             |\n";
    cout << "                         +-------------+\n";
    cout << RESET;
    cout << YELLOW << BOLD << "\n  Transiciones:\n" << RESET;
    cout << "  q0 --[+-]-->  q1\n  q0 --[0-9]--> q2\n";
    cout << "  q1 --[0-9]--> q2\n  q2 --[0-9]--> q2\n";
    cout << YELLOW << BOLD << "\n  Ejemplos validos:   " << RESET
         << GREEN << "0, 123, -45, +789, 1000\n" << RESET;
    cout << "  " << YELLOW << BOLD << "Ejemplos invalidos: " << RESET
         << RED << "01234, 12.5, +, -\n" << RESET;

    sepD();
    cout << CYAN << BOLD << "\n  NUMEROS DECIMALES\n" << RESET;
    cout << YELLOW << BOLD << "\n  Reglas Lexicas:\n" << RESET;
    cout << "  " << GREEN << "[OK]" << RESET << " Parte entera + punto + parte fraccionaria\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Ambas partes necesitan al menos un digito\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Pueden comenzar con signo (+ o -)\n";
    cout << "  " << GREEN << "[OK]" << RESET << " El punto decimal es obligatorio\n";
    cout << YELLOW << BOLD << "\n  Expresion Regular:\n" << RESET;
    cout << "  " << MAGENTA << "DECIMAL = [+-]?[0-9]+\\.[0-9]+\n" << RESET;
    cout << YELLOW << BOLD << "\n  AFD - Estado inicial: q0   Estados finales: { q4 }\n\n" << RESET;
    cout << CYAN;
    cout << "  q0-[+-]->q1-[0-9]->q2-[.]-q3-[0-9]->q4\n";
    cout << "  q0-[0-9]---------->q2          q4-[0-9]->q4\n";
    cout << "  q2-[0-9]---------->q2\n";
    cout << RESET;
    cout << YELLOW << BOLD << "\n  Transiciones:\n" << RESET;
    cout << "  q0-[+-]->q1  q0-[0-9]->q2  q1-[0-9]->q2\n";
    cout << "  q2-[0-9]->q2  q2-[.]->q3  q3-[0-9]->q4  q4-[0-9]->q4\n";
    cout << YELLOW << BOLD << "\n  Ejemplos validos:   " << RESET
         << GREEN << "3.14, -0.5, +123.456, 0.0\n" << RESET;
    cout << "  " << YELLOW << BOLD << "Ejemplos invalidos: " << RESET
         << RED << ".5, 123., 12..5, 3.14.15\n" << RESET;
}

void mostrarPalabrasReservadasEspec(){
    titulo("RECONOCIMIENTO DE PALABRAS RESERVADAS");
    cout << YELLOW << BOLD << "\n  Proceso de reconocimiento:\n" << RESET;
    cout << "  El analizador lexico identifica primero un identificador\n";
    cout << "  y luego verifica si es palabra reservada (tabla hash).\n";
    cout << YELLOW << BOLD << "\n  Reglas Lexicas:\n" << RESET;
    cout << "  " << GREEN << "[OK]" << RESET << " Siguen las mismas reglas que identificadores\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Son palabras predefinidas del lenguaje\n";
    cout << "  " << GREEN << "[OK]" << RESET << " Generalmente en minusculas\n";
    cout << "  " << RED   << "[NO]" << RESET << " No pueden ser redefinidas por el usuario\n";
    cout << YELLOW << BOLD << "\n  Algoritmo:\n" << RESET << CYAN;
    cout << "  +------------------------------------------+\n";
    cout << "  | 1. Leer cadena [a-zA-Z][a-zA-Z0-9_]*    |\n";
    cout << "  | 2. Buscar en tabla de palabras reservadas|\n";
    cout << "  |    Si encontrada -> token: PalRes        |\n";
    cout << "  |    Si no         -> token: ID            |\n";
    cout << "  +------------------------------------------+\n" << RESET;
    cout << YELLOW << BOLD << "\n  Expresion Regular:\n" << RESET << MAGENTA;
    cout << "  programa|inicio|fin|var|const|si|entonces|\n";
    cout << "  sino|mientras|hacer|contar|desde|hasta|  \n";
    cout << "  entero|real|cadena|booleano|verdadero|   \n";
    cout << "  falso|leer|escribir|limpiar              \n";
    cout << RESET;
}

void mostrarEjemploTokens(){
    titulo("EJEMPLO: ANALISIS PROGRAMA DEL PIZARRON");
    cout << YELLOW << BOLD << "\n  Codigo fuente:\n" << RESET << GRAY;
    cout << "  +-----------------------------------+\n";
    cout << "  | inicio                            |\n";
    cout << "  |     entero x;                     |\n";
    cout << "  |     entero y;                     |\n";
    cout << "  |     x = 8;                        |\n";
    cout << "  |     y = 2;                        |\n";
    cout << "  |     suma = x + y;                 |\n";
    cout << "  |     escribir(suma);               |\n";
    cout << "  | fin                               |\n";
    cout << "  +-----------------------------------+\n" << RESET;

    struct Tok{ string l,t; int c,r; };
    vector<Tok> tb={
        {"inicio",   "PalRes",1, 1},
        {"entero",   "PalRes",5, 2},{"x","ID",12,2},{";","Sim",13,2},
        {"entero",   "PalRes",5, 3},{"y","ID",12,3},{";","Sim",13,3},
        {"x","ID",5,4},{"=","Sim",7,4},{"8","Entero",9,4},{";","Sim",10,4},
        {"y","ID",5,5},{"=","Sim",7,5},{"2","Entero",9,5},{";","Sim",10,5},
        {"suma","ID",5,6},{"=","Sim",10,6},{"x","ID",12,6},
        {"+","Sim",14,6},{"y","ID",16,6},{";","Sim",17,6},
        {"escribir","PalRes",5,7},{"(","Sim",13,7},
        {"suma","ID",14,7},{")","Sim",18,7},{";","Sim",19,7},
        {"fin","PalRes",1,8},
    };

    cout << "\n" << GREEN << BOLD;
    cout << "  +------------------+-----------+-------+-------+\n";
    cout << "  | Lexema           | Tipo      |  Col  |  Ren  |\n";
    cout << "  +------------------+-----------+-------+-------+\n" << RESET;

    for(auto& t:tb){
        string c=RESET;
        if(t.t=="PalRes") c=BLUE;
        else if(t.t=="ID")     c=GREEN;
        else if(t.t=="Entero") c=MAGENTA;
        else if(t.t=="Sim")    c=GRAY;
        cout << "  | " << c << left << setw(16) << t.l << RESET
             << " | " << c << left << setw(9)  << t.t << RESET
             << " | " << right << setw(5) << t.c
             << " | " << right << setw(5) << t.r << " |\n";
    }
    cout << GREEN << "  +------------------+-----------+-------+-------+\n" << RESET;
    cout << "\n  " << GREEN << "[OK] PROGRAMA VALIDO - Sin errores lexicos\n" << RESET;

    sepD();
    cout << RED << BOLD << "\n  Ejemplo con ERRORES (como en el pizarron):\n" << RESET << GRAY;
    cout << "  inicio\n";
    cout << "      entero x#;    <- # invalido Col 14, Ren 2\n";
    cout << "      @y = 2;       <- @ invalido Col 5,  Ren 3\n";
    cout << "  fin\n" << RESET;
    cout << RED << BOLD << "\n  Errores reportados:\n" << RESET << RED;
    cout << "  [ERROR] Id no valido '#' en Col 14, Ren 2\n";
    cout << "  [ERROR] Id no valido '@' en Col 5,  Ren 3\n" << RESET;
}

void mostrarMenu(){
    cout << "\n" << CYAN << BOLD;
    cout << "  +--------------------------------------------+\n";
    cout << "  |      ESPECIFICACION LEXICA COMPLETA        |\n";
    cout << "  +--------------------------------------------+\n";
    cout << "  |  1. Palabras Reservadas                    |\n";
    cout << "  |  2. Simbolos Especiales                    |\n";
    cout << "  |  3. Identificadores  (AFD + Regex)         |\n";
    cout << "  |  4. Cadenas          (AFD + Regex)         |\n";
    cout << "  |  5. Numeros Enteros y Decimales (AFD)      |\n";
    cout << "  |  6. Reconocimiento de Pal. Reservadas      |\n";
    cout << "  |  7. Ejemplo Completo de Tokens             |\n";
    cout << "  |  8. Mostrar TODO                           |\n";
    cout << "  |  0. Salir                                  |\n";
    cout << "  +--------------------------------------------+\n" << RESET;
    cout << "\n  " << WHITE << "Opcion: " << RESET;
}

int main(){
#ifdef _WIN32
    // Habilitar colores ANSI y UTF-8 directamente via WinAPI
    HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
    DWORD dwMode = 0;
    GetConsoleMode(hOut, &dwMode);
    SetConsoleMode(hOut, dwMode | ENABLE_VIRTUAL_TERMINAL_PROCESSING);
    SetConsoleOutputCP(65001);
#endif

    limpiarPantalla();
    cout << CYAN << BOLD;
    cout << "  +------------------------------------------------------------+\n";
    cout << "  |       ANALIZADOR LEXICO - DOCUMENTACION COMPLETA          |\n";
    cout << "  |         Lenguaje PseudoCodigo Espanol v1.0                |\n";
    cout << "  +------------------------------------------------------------+\n";
    cout << RESET;

    int op;
    do{
        mostrarMenu();
        cin >> op; cin.ignore();
        limpiarPantalla();
        switch(op){
            case 1: mostrarPalabrasReservadas();       pausar(); break;
            case 2: mostrarSimbolos();                 pausar(); break;
            case 3: mostrarIdentificadores();          pausar(); break;
            case 4: mostrarCadenas();                  pausar(); break;
            case 5: mostrarNumeros();                  pausar(); break;
            case 6: mostrarPalabrasReservadasEspec();  pausar(); break;
            case 7: mostrarEjemploTokens();            pausar(); break;
            case 8:
                mostrarPalabrasReservadas();       pausar(); limpiarPantalla();
                mostrarSimbolos();                 pausar(); limpiarPantalla();
                mostrarIdentificadores();          pausar(); limpiarPantalla();
                mostrarCadenas();                  pausar(); limpiarPantalla();
                mostrarNumeros();                  pausar(); limpiarPantalla();
                mostrarPalabrasReservadasEspec();  pausar(); limpiarPantalla();
                mostrarEjemploTokens();            pausar();
                break;
            case 0:
                cout << "\n" << CYAN << "  Hasta luego!\n\n" << RESET;
                break;
            default:
                cout << RED << "\n  Opcion no valida.\n" << RESET;
                pausar();
        }
        if(op!=0) limpiarPantalla();
    }while(op!=0);
    return 0;
}
